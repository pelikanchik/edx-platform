<%! from django.utils.translation import ugettext as _ %>
<%! from courseware.courses import get_course %>
<%namespace name='static' file='static_content.html'/>

<script type="text/javascript" src="${static.url('js/sticky-go-button.js')}" charset="utf-8"></script>

% if get_course(course_id).has_dynamic_graph and (not staff_access or masquerade == "student"):
<div id="sequence_${element_id}" class="sequence" data-id="${item_id}" data-position="${position}" data-ajax-url="${ajax_url}" data-history-position="${history_position}" data-from-link="${from_link}">
% else:
<div id="sequence_${element_id}" class="sequence" data-id="${item_id}" data-position="${position}" data-ajax-url="${ajax_url}">
% endif
  <nav aria-label="${_('Section Navigation')}" class="sequence-nav">
    <ul class="sequence-nav-buttons">
      % if get_course(course_id).has_dynamic_graph and (not staff_access or masquerade == "student"):
        <li class = "gobackdynamo"><a href= "#">${_("Previous")}</a></li>
      % else:
        <li class="prev"><a href="#">${_('Previous')}</a></li>
      % endif
    </ul>

    <div class="sequence-list-wrapper">
      <ol id="sequence-list">
       % if get_course(course_id).has_dynamic_graph and (not staff_access or masquerade == "student"):
          % for idx, key in enumerate(progress_history):
          ## TODO (vshnayder): add item.progress_detail either to the title or somewhere else.
          ## Make sure it gets updated after ajax calls.
          ## implementation note: will need to figure out how to handle combining detail
          ## statuses of multiple modules in js.
            <li>
            <a class="seq_${items[key]['type']} inactive progress-${items[key]['progress_status']}"
               data-id="${items[key]['id']}"
               data-element="${items.keys().index(key)+1}"
               data-history-position="${idx+1}"
               href="javascript:void(0);">
                <p aria-hidden="false">${items[key]['title']}<span class="sr">, ${items[key]['type']}</span></p>  
              </a>
            </li>
          % endfor
        % else:
          % for idx, item in enumerate(items.values()):

          ## TODO (vshnayder): add item.progress_detail either to the title or somewhere else.
          ## Make sure it gets updated after ajax calls.
          ## implementation note: will need to figure out how to handle combining detail
          ## statuses of multiple modules in js.
          <li>
          <a class="seq_${item['type']} inactive progress-${item['progress_status']}"
             data-id="${item['id']}"
             data-element="${idx+1}"
             href="javascript:void(0);">
              <p aria-hidden="false">${item['title']}<span class="sr">, ${item['type']}</span></p>
            </a>
          </li>
          % endfor
        % endif
      </ol>
    </div>
    <ul class="sequence-nav-buttons">
      % if get_course(course_id).has_dynamic_graph:
        <li class="godynamo"><a href="#">${_("Next")}</a></li>
      % else:
        <li class="next"><a href="#">${_("Next")}</a></li>
      % endif
    </ul>

  </nav>
    <br/>

  % for key, item in items.items():
    <div class="seq_contents tex2jax_ignore asciimath2jax_ignore ${key}"
            data-direct_term="${item['direct_term']}"
            data-progress_detail="${item['progress_detail']}">
        ${item['content'] | h}
    </div>
  % endfor

  <div id="seq_content"></div>

  <nav class="sequence-bottom">
    <ul aria-label="${_('Section Navigation')}" class="sequence-nav-buttons">
      % if get_course(course_id).has_dynamic_graph:
        % if staff_access:
          <li class="prev"><a href="#">${_("Previous")}</a></li>
        % else:
          <li class="gobackdynamo"><a href="#">${_("Previous")}</a></li>
        % endif
        <li class = "godynamo"><a href= "#">${_("Next")}</a></li>
      % else:
        <li class="prev"><a href="#">${_("Previous")}</a></li>
        <li class="next"><a href="#">${_("Next")}</a></li>
      % endif
    </ul>
  </nav>
  % if get_course(course_id).has_dynamic_graph and (not staff_access or masquerade == "student"):
    <input class="resethistory" style="" type="button" value="${_('Start over')}">
  % endif
</div>



<script type="text/javascript">
  var sequenceNav;
  $(document).ready(function() {
    sequenceNav = new SequenceNav($('.sequence-nav'));
  });
</script>

<input type="hidden" id="has_dynamic_graph" value="${get_course(course_id).has_dynamic_graph}">
<input type="hidden" id="staff_access" value="${staff_access}">
<input type="hidden" id="masquerade" value="${masquerade}">
% if get_course(course_id).has_dynamic_graph and (not staff_access or masquerade == "student"):
  <input type="hidden" id="history_length" value="${len(progress_history)}">
% endif

<div style="display: none;" id="hidden_seq_buttons">
  % for idx, key in enumerate(items.keys()):
    <a class="seq_${items[key]['type']} inactive progress-${items[key]['progress_status']}"
     data-id="${items[key]['id']}"
     data-element="${idx+1}"
     data-history-position=""
     href="javascript:void(0);">
      <p aria-hidden="false">${items[key]['title']}<span class="sr">, ${items[key]['type']}</span></p>
    </a>
  %endfor
 </div>